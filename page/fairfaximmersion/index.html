<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Fairfax Country Immersion Schools</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <!--<script src="http://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.7/crossfilter.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.5.0/d3-legend.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>

    <style type="text/css">
        body {
            background-color: white;
            font-family: Helvetica, Arial, sans-serif;
        }

        h1 {
            font-size: 26px;
            margin: 7px;
        }

        h3 {
            font-size: 13px;
            margin: 7px;
            font-weight: normal;
        }

        svg {
            background-color: white;
        }

        .button {
            border: 2.5px solid white;
            -moz-border-radius: 7px;
            -webkit-border-radius: 7px;
            border-radius: 7px;
            display: inline-block;
            padding: 2.0px 0;
            line-height: 25px;
            background: lightgrey;
            width: 70px;
            text-align: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

            .button:hover {
                color: darkgray;
                cursor: pointer;
            }

        .barchart {
            font-family: Helvetica, Arial, sans-serif;
            z-index: 1;
            position: absolute;
            width: auto;
            height: auto;
            padding: 4px;
            /*font-weight: bold;*/
            background-color: white;
            opacity: 1;
            font-size: 15px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }

            .barchart p {
                margin: 0;
                font-family: Helvetica, Arial, sans-serif;
                font-size: 1em;
                line-height: 1;
            }

        #countrytooltip {
            font-family: Helvetica, Arial, sans-serif;
            z-index: 1;
            position: absolute;
            width: auto;
            height: auto;
            padding: 6px;
            background-color: white;
            opacity: 1;
            font-size: 15px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }

            #countrytooltip.hidden {
                display: none;
            }

        .legendLinear {
            font-family: Helvetica, Arial, sans-serif;
            font-size: 13px;
            /*font-weight: bold;*/
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 10px;
        }

        .y.axis path,
        .y.axis line {
            opacity: 0;
        }
    </style>
</head>
<body>
    <h1>Fairfax County Immersion Schools</h1>
    <h3></h3>
    
    <script type="text/javascript">
            var svg;
            var map;
 
            queue()
                .defer(d3.json, 'School_Regions_topo.json')
                .defer(d3.json, 'School_Facilities_topo.json')
                .defer(d3.json, 'Supervisor_Districts_topo.json')
                .await(setupMap);

            var width = 1200;
            var height = 800;
            
            var margin = { top: 4, right: 6, bottom: 16, left: -5 };

            function setupMap(error, regions, facilities, districts) {

                // Convert TopoJSON to GeoJSON 
                var regions = topojson.feature(regions, regions.objects.School_Regions);
                var facilities = topojson.feature(facilities, facilities.objects.School_Facilities);
                var districts = topojson.feature(districts, districts.objects.Supervisor_Districts);

                path = makePathGenerator(districts);

                svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .style("background", "6baed6")

                var all = svg.append('g')
                    .attr('class', 'boundary');

                map = all.selectAll('path')
                    .data(districts.features)
                    .enter()
                    .append('path')
                    .attr('d', path)
                    .attr("stroke", "dimgray")
                    .style("fill", function (d) {
                        //return d.value ? color(d.value) : defaultColor;
                        return "green";
                    })
                    .style("fill-opacity", function (d) {
                        return d.value ? 0.5 : 1.0;
                    })
                    .style('fill-opacity', 0.5)
                    .on('mouseover', function (d) {

                        d3.select(this).style('fill-opacity', 1)
                            .attr("stroke", "black")
                            .attr("stroke-width", 2);

                        d3.select("#countrytooltip")
                            .style("left", (d3.event.pageX + 15) + "px")
                            .style("top", (d3.event.pageY - 10) + "px")
                            .select("#country")
                            .text("Hello");

                        d3.select("#countrytooltip").classed("hidden", false);
                    })
                    .on('mouseout', function (d) {
                        d3.select(this)
                            .style('fill-opacity', .5)
                            .attr("stroke", "dimgray")
                            .attr("stroke-width", 1);

                        d3.select("#countrytooltip").classed("hidden", true);
                    });
            }
    

            // http://stackoverflow.com/questions/14492284/center-a-map-in-d3-given-a-geojson-object
            function makePathGenerator(features) {
                var projection = d3.geo.albers()
                    .scale(1)
                    .translate([0, 0]);

                // Create a path generator.
                var path = d3.geo.path()
                    .projection(projection);

                // Compute the bounds of a feature of interest, then derive scale & translate.
                var scootLeft = 250;
                var b = path.bounds(features),
                    s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
                    t = [((width - s * (b[1][0] + b[0][0])) / 2) - scootLeft, (height - s * (b[1][1] + b[0][1])) / 2];

                // Update the projection to use computed scale & translate.
                projection
                    .scale(s)
                    .translate(t);

                return path;
            }
    </script>
</body>
</html>